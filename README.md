# LEAP

## Setup

To setup the environment for running the experiments, first clone the repository:

```bash
git clone https://github.com/lorenzovolpi/LEAP.git leap --depth 1
cd leap
```

then create the python virtual environment and install requirements:

```bash
python -m venv .venv
chmod +x .venv/bin/activate
source ./.venv/bin/activate
python -m pip install -e .
```

## Run

### Experiments

To run the experiments shown in the cited paper, run:

```bash
python -m exp.main           # for the main experiments
python -m exp.bootstrap      # for the experiments related to confidence intervals
python -m exp.sample_size    # for the expetiments related to variable sample size
python -m exp.qerr           # for the experiments related to quantification error
```

To control the desired setting to run the experiments (i.e., whether `binary` or `multiclass`) change the value of the variable `PROBLEM` in the file `leap/exp/env.py`.

### Plots and Tables

To generate the plots run:

```bash
python -m exp.plot --main    # for diagonal plots relating true and estimated accuracy
python -m exp.plot --ctdiff  # for heatmap plots showint contingency table errors
python -m exp.plot --ssize   # for plots showing the CAP error in function of the test sample size
python -m exp.plot --shift   # for plots showing CAP error in function of PPS
python -m exp.plot --times   # for inference time plots
python -m exp.plot --qerr    # for plots relating CAP error and quantification error
```

To generate the tables run:

```bash
python -m exp.table --main   # for the main tables
python -m exp.table --ci     # for the tables relative to confidence intervals
```

To control the problem setting while generating plots and tables, simply pass the command line argument `-p binary` or `-p multiclass`.

### Output

The `output` folder will containe the subfolders:
- `leap` with the results for the main experiments;
- `sample_size` with the results for the variable sample size experiments;
- `bootstrap` with the results on the confidence intervals experiments;
- `qerr` with the results on the the quantification error experiments:
- `plots` containing all the generated plots;
- `tables` containing both the `.pdf` and the `.tex` files of the generated tables.

The folder `output/plots` already contains all the plots generated by the authors.

To change the output root folder export the `LEAP_OUT_DIR` environment variable 
before running the above commands.

### Parallel execution

The execution of the tests is parallelised, with each combination of (`classifier`, `dataset`, `method`)
running in a separate process. The `LEAP_N_JOBS` environment variable controls the number
of availables processors to dedicate to the execution.
